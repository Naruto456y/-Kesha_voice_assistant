import random
import time
import sys
import os

# Функция для сохранения прогресса
def save_progress(progress):
    with open('file_for_progress.txt', 'w') as file:
        file.write(str(progress))

# Функция для загрузки прогресса
def load_progress():
    if os.path.exists('file_for_progress.txt'):
        with open('file_for_progress.txt', 'r') as file:
            try:
                return int(file.read().strip())
            except ValueError:
                return 0
    return 0

# База данных вопросов (остаётся без изменений)
questions = {
    "Общие знания": [
        {
            "question": "Сколько планет в Солнечной системе?",
            "options": ["7", "8", "9", "10"],
            "answer": "8"
        },
        {
            "question": "Какая самая длинная река в мире?",
            "options": ["Амазонка", "Нил", "Янцзы", "Миссисипи"],
            "answer": "Амазонка"
        },
        {
            "question": "Столица Австралии?",
            "options": ["Сидней", "Мельбурн", "Канберра", "Брисбен"],
            "answer": "Канберра"
        },
        {
            "question": "Сколько континентов на Земле?",
            "options": ["5", "6", "7", "8"],
            "answer": "6"
        },
        {
            "question": "Какая самая большая страна по площади?",
            "options": ["Китай", "США", "Канада", "Россия"],
            "answer": "Россия"
        },
        {
            "question": "Какое животное является символом Австралии?",
            "options": ["Коала", "Кенгуру", "Утконос", "Эму"],
            "answer": "Кенгуру"
        },
        {
            "question": "Как называется самая большая пустыня в мире?",
            "options": ["Гоби", "Сахара", "Аравийская", "Антарктическая"],
            "answer": "Антарктическая"
        },
        {
            "question": "В каком году началась Вторая мировая война?",
            "options": ["1937", "1939", "1941", "1943"],
            "answer": "1939"
        },
        {
            "question": "Какой газ преобладает в составе атмосферы Земли?",
            "options": ["Кислород", "Углекислый газ", "Азот", "Аргон"],
            "answer": "Азот"
        },
        {
            "question": "Какой океан самый большой по площади?",
            "options": ["Атлантический", "Индийский", "Северный Ледовитый", "Тихий"],
            "answer": "Тихий"
        },
        {
            "question": "Какая страна имеет самое большое население в мире?",
            "options": ["Индия", "США", "Китай", "Индонезия"],
            "answer": "Индия"
        },
        {
            "question": "Как называется самая высокая гора в мире?",
            "options": ["Килиманджаро", "Эверест", "Аконкагуа", "Мак-Кинли"],
            "answer": "Эверест"
        },
        {
            "question": "Кто изобрел телефон?",
            "options": ["Томас Эдисон", "Александр Белл", "Никола Тесла", "Гульельмо Маркони"],
            "answer": "Александр Белл"
        },
        {
            "question": "Какое самое глубокое озеро в мире?",
            "options": ["Виктория", "Байкал", "Танганьика", "Каспийское море"],
            "answer": "Байкал"
        },
        {
            "question": "В каком году человек впервые полетел в космос?",
            "options": ["1957", "1961", "1969", "1975"],
            "answer": "1961"
        },
        {
            "question": "Какой химический элемент обозначается как 'Hg'?",
            "options": ["Серебро", "Золото", "Ртуть", "Германий"],
            "answer": "Ртуть"
        },
        {
            "question": "Какое самое быстрое наземное животное?",
            "options": ["Лев", "Гепард", "Антилопа гну", "Борзая собака"],
            "answer": "Гепард"
        },
        {
            "question": "Сколько цветов в радуге согласно традиционному делению?",
            "options": ["5", "6", "7", "8"],
            "answer": "7"
        },
        {
            "question": "Какой мобильный оператор использует логотип в виде пчелы?",
            "options": ["МТС", "Билайн", "МегаФон", "Tele2"],
            "answer": "Билайн"
        },
        {
            "question": "Как называется самая популярная ОС для смартфонов?",
            "options": ["iOS", "Android", "HarmonyOS", "Windows Phone"],
            "answer": "Android"
        }
    ],
    "Литература": [
        {
            "question": "Кто написал 'Войну и мир'?",
            "options": ["Достоевский", "Толстой", "Чехов", "Тургенев"],
            "answer": "Толстой"
        },
        {
            "question": "Кто написал 'Ромео и Джульетту'?",
            "options": ["Чарльз Диккенс", "Уильям Шекспир", "Лев Толстой", "Марк Твен"],
            "answer": "Уильям Шекспир"
        },
        {
            "question": "Кто автор 'Преступления и наказания'?",
            "options": ["Толстой", "Достоевский", "Гоголь", "Тургенев"],
            "answer": "Достоевский"
        },
        {
            "question": "Какой поэт написал 'Я помню чудное мгновенье...'?",
            "options": ["Лермонтов", "Пушкин", "Тютчев", "Некрасов"],
            "answer": "Пушкин"
        },
        {
            "question": "Кто создал Шерлока Холмса?",
            "options": ["Агата Кристи", "Артур Конан Дойл", "Стивен Кинг", "Чарльз Диккенс"],
            "answer": "Артур Конан Дойл"
        },
        {
            "question": "Какое произведение написал Михаил Булгаков?",
            "options": ["Тихий Дон", "Доктор Живаго", "Мастер и Маргарита", "Петр Первый"],
            "answer": "Мастер и Маргарита"
        },
        {
            "question": "Кто автор 'Гарри Поттера'?",
            "options": ["Дж. Р. Р. Толкин", "Дж. К. Роулинг", "Клайв Льюис", "Стивен Кинг"],
            "answer": "Дж. К. Роулинг"
        },
        {
            "question": "Какое произведение принадлежит перу Эрнеста Хемингуэя?",
            "options": ["1984", "Старик и море", "Улисс", "Над пропастью во ржи"],
            "answer": "Старик и море"
        },
        {
            "question": "Кто написал 'Три мушкетера'?",
            "options": ["Виктор Гюго", "Александр Дюма", "Жюль Верн", "Оноре де Бальзак"],
            "answer": "Александр Дюма"
        },
        {
            "question": "Какой русский писатель автор 'Мертвых душ'?",
            "options": ["Толстой", "Достоевский", "Гоголь", "Тургенев"],
            "answer": "Гоголь"
        },
        {
            "question": "Кто написал 'Алису в Стране чудес'?",
            "options": ["Льюис Кэрролл", "Дж. М. Барри", "Редьярд Киплинг", "Алан Милн"],
            "answer": "Льюис Кэрролл"
        },
        {
            "question": "Какое произведение принадлежит Льву Толстому?",
            "options": ["Отцы и дети", "Обломов", "Анна Каренина", "Идиот"],
            "answer": "Анна Каренина"
        },
        {
            "question": "Кто автор 'Фауста'?",
            "options": ["Фридрих Шиллер", "Иоганн Вольфганг Гёте", "Генрих Гейне", "Франц Кафка"],
            "answer": "Иоганн Вольфганг Гёте"
        },
        {
            "question": "Какое произведение написал Антон Чехов?",
            "options": ["Вишневый сад", "На дне", "Отцы и дети", "Дворянское гнездо"],
            "answer": "Вишневый сад"
        },
        {
            "question": "Кто автор 'Властелина колец'?",
            "options": ["Дж. К. Роулинг", "Дж. Р. Р. Толкин", "Клайв Льюис", "Терри Пратчетт"],
            "answer": "Дж. Р. Р. Толкин"
        },
        {
            "question": "Какое произведение принадлежит Джорджу Оруэллу?",
            "options": ["451° по Фаренгейту", "1984", "О дивный новый мир", "Мы"],
            "answer": "1984"
        },
        {
            "question": "Кто написал 'Дон Кихота'?",
            "options": ["Мигель де Сервантес", "Федерико Гарсиа Лорка", "Пабло Неруда", "Габриэль Гарсиа Маркес"],
            "answer": "Мигель де Сервантес"
        },
        {
            "question": "Какое произведение принадлежит Федору Достоевскому?",
            "options": ["Война и мир", "Идиот", "Отцы и дети", "Обломов"],
            "answer": "Идиот"
        },
        {
            "question": "Кто автор 'Маленького принца'?",
            "options": ["Антуан де Сент-Экзюпери", "Жюль Верн", "Виктор Гюго", "Гюстав Флобер"],
            "answer": "Антуан де Сент-Экзюпери"
        },
        {
            "question": "Какое произведение написал Николай Гоголь?",
            "options": ["Ревизор", "Горе от ума", "Гроза", "Бесы"],
            "answer": "Ревизор"
        }
    ],
    "Наука": [
        {
            "question": "Сколько элементов в периодической таблице?",
            "options": ["108", "118", "128", "138"],
            "answer": "118"
        },
        {
            "question": "Какой химический элемент обозначается как 'Au'?",
            "options": ["Серебро", "Железо", "Золото", "Алюминий"],
            "answer": "Золото"
        },
        {
            "question": "Какой газ преобладает в составе атмосферы Земли?",
            "options": ["Кислород", "Углекислый газ", "Азот", "Аргон"],
            "answer": "Азот"
        },
        {
            "question": "Сколько хромосом у здорового человека?",
            "options": ["23", "46", "64", "32"],
            "answer": "46"
        },
        {
            "question": "Какая самая высокая гора в Солнечной системе?",
            "options": ["Эверест", "Олимп (Марс)", "Килиманджаро", "Мауна-Кеа"],
            "answer": "Олимп (Марс)"
        },
        {
            "question": "Как называется самая большая кость в человеческом теле?",
            "options": ["Позвоночник", "Бедренная", "Череп", "Лопатка"],
            "answer": "Бедренная"
        },
        {
            "question": "Какое самое быстрое наземное животное?",
            "options": ["Лев", "Гепард", "Антилопа", "Леопард"],
            "answer": "Гепард"
        },
        {
            "question": "Какой ученый сформулировал теорию относительности?",
            "options": ["Исаак Ньютон", "Альберт Эйнштейн", "Никола Тесла", "Стивен Хокинг"],
            "answer": "Альберт Эйнштейн"
        },
        {
            "question": "Какой орган человеческого тела самый большой?",
            "options": ["Печень", "Мозг", "Кожа", "Сердце"],
            "answer": "Кожа"
        },
        {
            "question": "Какая планета ближе всего к Солнцу?",
            "options": ["Венера", "Марс", "Меркурий", "Земля"],
            "answer": "Меркурий"
        },
        {
            "question": "Как называется наука о растениях?",
            "options": ["Зоология", "Ботаника", "Биология", "Экология"],
            "answer": "Ботаника"
        },
        {
            "question": "Какой элемент самый легкий?",
            "options": ["Гелий", "Водород", "Литий", "Кислород"],
            "answer": "Водород"
        },
        {
            "question": "Сколько костей в теле взрослого человека?",
            "options": ["156", "206", "256", "306"],
            "answer": "206"
        },
        {
            "question": "Как называется процесс фотосинтеза у растений?",
            "options": ["Поглощение кислорода", "Выделение углекислого газа", 
                    "Преобразование света в энергию", "Испарение воды"],
            "answer": "Преобразование света в энергию"
        },
        {
            "question": "Какой газ растения поглощают днем?",
            "options": ["Кислород", "Углекислый газ", "Азот", "Водород"],
            "answer": "Углекислый газ"
        },
        {
            "question": "Какая самая твердая природная субстанция в организме человека?",
            "options": ["Кость", "Зубная эмаль", "Ноготь", "Хрящ"],
            "answer": "Зубная эмаль"
        },
        {
            "question": "Какой ученый открыл закон всемирного тяготения?",
            "options": ["Галилео Галилей", "Исаак Ньютон", "Николай Коперник", "Альберт Эйнштейн"],
            "answer": "Исаак Ньютон"
        },
        {
            "question": "Как называется самая маленькая частица вещества?",
            "options": ["Молекула", "Атом", "Электрон", "Кварк"],
            "answer": "Атом"
        },
        {
            "question": "Какой элемент является основой органической химии?",
            "options": ["Кислород", "Углерод", "Водород", "Азот"],
            "answer": "Углерод"
        },
        {
            "question": "Какой витамин вырабатывается в коже под действием солнечного света?",
            "options": ["Витамин A", "Витамин C", "Витамин D", "Витамин E"],
            "answer": "Витамин D"
        }
    ],
    "IT": [
        {
            "question": "Какой язык программирования самый популярный в 2023 году?",
            "options": ["Python", "JavaScript", "Java", "C++"],
            "answer": "Python"
        },
        {
            "question": "Что означает аббревиатура 'HTTP'?",
            "options": ["HyperText Transfer Protocol", 
                    "High Transfer Text Protocol",
                    "Hyper Transfer Text Protocol",
                    "HighText Transfer Protocol"],
            "answer": "HyperText Transfer Protocol"
        },
        {
            "question": "Какой оператор в Python используется для целочисленного деления?",
            "options": ["/", "//", "%", "**"],
            "answer": "//"
        },
        {
            "question": "Что выведет `print(2 + 2 * 2)` в Python?",
            "options": ["6", "8", "4", "Ошибку"],
            "answer": "6"
        },
        {
            "question": "Как называется стандартная библиотека Python для работы с регулярными выражениями?",
            "options": ["regex", "re", "pyregex", "pattern"],
            "answer": "re"
        },
        {
            "question": "Какой тип данных в Python является неизменяемым?",
            "options": ["Список", "Словарь", "Множество", "Кортеж"],
            "answer": "Кортеж"
        },
        {
            "question": "Кто создал язык Python?",
            "options": ["Билл Гейтс", "Гвидо ван Россум", "Линус Торвальдс", "Деннис Ритчи"],
            "answer": "Гвидо ван Россум"
        },
        {
            "question": "Какой язык программирования используется для стилей веб-страниц?",
            "options": ["HTML", "CSS", "JavaScript", "PHP"],
            "answer": "CSS"
        },
        {
            "question": "Что означает аббревиатура 'HTML'?",
            "options": ["HyperText Markup Language",
                    "HighText Machine Language",
                    "HyperText Machine Language",
                    "HighText Markup Language"],
            "answer": "HyperText Markup Language"
        },
        {
            "question": "Какой язык программирования разработала компания Microsoft?",
            "options": ["Java", "C#", "Python", "Ruby"],
            "answer": "C#"
        },
        {
            "question": "Какой метод Python используется для добавления элемента в список?",
            "options": [".add()", ".append()", ".insert()", ".push()"],
            "answer": ".append()"
        },
        {
            "question": "Что делает метод .strip() в Python?",
            "options": ["Разделяет строку", "Удаляет пробелы по краям", "Переводит в верхний регистр", "Заменяет подстроку"],
            "answer": "Удаляет пробелы по краям"
        },
        {
            "question": "Какой оператор используется для возведения в степень в Python?",
            "options": ["^", "**", "*", "^^"],
            "answer": "**"
        },
        {
            "question": "Что выведет `print(type(3.14))` в Python?",
            "options": ["<class 'int'>", "<class 'float'>", "<class 'decimal'>", "<class 'number'>"],
            "answer": "<class 'float'>"
        },
        {
            "question": "Как называется оператор `... if ... else ...` в Python?",
            "options": ["Условный оператор", "Тернарный оператор", "Логический оператор", "Оператор выбора"],
            "answer": "Тернарный оператор"
        },
        {
            "question": "Какой язык используется для создания интерактивности на веб-страницах?",
            "options": ["HTML", "CSS", "JavaScript", "PHP"],
            "answer": "JavaScript"
        },
        {
            "question": "Какой язык программирования разработал Брендан Эйх?",
            "options": ["Python", "Java", "JavaScript", "Ruby"],
            "answer": "JavaScript"
        },
        {
            "question": "Что означает аббревиатура 'SQL'?",
            "options": ["Structured Query Language",
                    "Simple Query Language",
                    "Standard Query Language",
                    "System Query Language"],
            "answer": "Structured Query Language"
        },
        {
            "question": "Какой язык программирования используется для разработки приложений под Android?",
            "options": ["Swift", "Kotlin", "C#", "Ruby"],
            "answer": "Kotlin"
        },
        {
            "question": "Какой язык программирования разработала Apple?",
            "options": ["Kotlin", "Swift", "Dart", "Go"],
            "answer": "Swift"
        }
    ]
}

def select_category():
    print("\nДоступные категории вопросов:")
    categories = list(questions.keys())
    for i, category in enumerate(categories, 1):
        print(f"{i}. {category} ({len(questions[category])} вопросов)")
    
    while True:
        try:    
            choice = int(input("\nВыберите номер категории: "))
            if 1 <= choice <= len(categories):
                return categories[choice-1]
            print(f"Пожалуйста, введите число от 1 до {len(categories)}")
        except ValueError:
            print("Пожалуйста, введите число!")

def run_quiz():
    print("\033[1;32m" + '                🚀 Викторина 🚀' + "\033[0m")
    
    # Выбор категории
    category = select_category()
    category_questions = questions[category].copy()
    random.shuffle(category_questions)
    
    print("\033[1;32m" + f'Ответьте на {len(category_questions)} вопросов по категории "{category}"' + "\033[0m")
    print("\033[1;32m" + 'У вас 2 минуты' + "\033[0m")
    print('\033[1m'+ '\n')
    
    score = 0
    previous_progress = load_progress()
    
    for i, q in enumerate(category_questions, 1):
        options = q["options"].copy()
        correct_answer = q["answer"]
        random.shuffle(options)
        
        correct_index = options.index(correct_answer) + 1
        
        print(f'\nВопрос №{i}. {q["question"]}')
        for idx, option in enumerate(options, 1):
            print(f'{idx}. {option}')
        
        while True:
            inp = input('Введите номер вашего ответа (1-4): ')
            if inp.isdigit() and 1 <= int(inp) <= 4:
                break
            print("Ошибка! Пожалуйста, введите число от 1 до 4.")
        
        if options[int(inp)-1] == correct_answer:
            print("✅ Правильно! +1 балл")
            score += 1
        else:
            print(f"❌ Неверно! Правильный ответ: {correct_index}. {correct_answer}")
        
        time.sleep(1)

    print('\n' + '='*40 + '\n' + f'Ваш результат {score} из {len(category_questions)}\n' + '='*40)

    if previous_progress:
        if score < previous_progress:
            print(f'Ваш прошлый прогресс {previous_progress} очков')
        elif score > previous_progress:
            print(f'Поздравляю, вы побили свой прошлый результат {previous_progress} очков')
        else:
            print(f'Вы повторили свой прошлый результат {previous_progress} очков')
    
    if score == len(category_questions):
        print("Идеально! Вы настоящий эрудит! 🎯")
    elif score >= len(category_questions) * 0.7:
        print("Отличный результат! 👍")
    elif score >= len(category_questions) * 0.5:
        print("Хороший результат! 😊")
    else:
        print("Попробуйте еще раз! 💪")
    print('='*40)
    
    save_progress(score)
    
    while True:
        p = input('Хотите сыграть ещё раз? (да/нет): ').lower()
        if p in ('да', 'нет'):
            return p == 'да'
        print('Пожалуйста, введите "да" или "нет"')

# Основной цикл программы
while True:
    if not run_quiz():
        print("Спасибо за игру! До свидания!")
        time.sleep(2)
        break